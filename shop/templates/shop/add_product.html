{% extends "shop/base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="form-narrow">
    <div class="card shadow card-form-sm">
      <div class="card-body p-3 p-md-4">
        <h3 class="text-center mb-3 fw-semibold">
          <i class="bi bi-box-seam me-2"></i>Agregar Producto
        </h3>

        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="row g-3">
            <!-- Nombre -->
            <div class="col-md-6">
              <label class="form-label small mb-1">Nombre del Producto</label>
              <div class="input-group input-group-sm">
                <span class="input-group-text"><i class="bi bi-tag"></i></span>
                <input type="text" name="name" class="form-control form-control-sm" required>
              </div>
            </div>

            <!-- Categoría -->
            <div class="col-md-6">
              <label class="form-label small mb-1">Categoría</label>
              <div class="input-group input-group-sm">
                <span class="input-group-text"><i class="bi bi-ui-checks-grid"></i></span>
                <select name="category" class="form-select form-select-sm" required>
                  <option value="" disabled selected>Selecciona una categoría</option>
                  {% for value, label in categories %}
                    <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <!-- Marca -->
            <div class="col-12">
              <label class="form-label small mb-1">Marca del Auto</label>
              <div class="input-group input-group-sm">
                <span class="input-group-text"><i class="bi bi-car-front"></i></span>
                <select name="marca" id="id_marca" class="form-select form-select-sm" required>
                  <option value="" disabled selected>Selecciona una marca</option>
                  {% for value, label in brands %}
                    <option value="{{ value }}">{{ label }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <!-- Descripción -->
            <div class="col-12">
              <label class="form-label small mb-1">Descripción</label>
              <textarea name="description" class="form-control form-control-sm" rows="3"
                        placeholder="Detalle características, compatibilidades, etc."></textarea>
            </div>

            <!-- Precio / Stock -->
            <div class="col-md-6">
              <label class="form-label small mb-1">Precio</label>
              <div class="input-group input-group-sm">
                <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
                <input type="number" name="price" step="0.01" class="form-control form-control-sm" required>
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label small mb-1">Stock Disponible</label>
              <div class="input-group input-group-sm">
                <span class="input-group-text"><i class="bi bi-boxes"></i></span>
                <input type="number" name="stock" class="form-control form-control-sm" value="0" required>
              </div>
            </div>

            <!-- Imagen + preview -->
            <div class="col-12">
              <label class="form-label small mb-1">Imagen del Producto</label>
              <input type="file" id="image" name="image" class="form-control form-control-sm">
              <div class="mt-2 d-none" id="imagePreviewWrap">
                <img id="imagePreview" class="img-thumbnail preview-img" alt="Vista previa">
              </div>
            </div>

            <!-- Modelos -->
            <div class="col-12">
              <div class="models-header">
                <label class="form-label small m-0">Modelos Compatibles</label>
                <div class="models-toolbar">
                  <input type="text" id="modelSearch" class="form-control form-control-sm" placeholder="Buscar…">
                  <button type="button" class="btn btn-sm btn-outline-secondary" id="btnSelectAll">Todos</button>
                  <button type="button" class="btn btn-sm btn-outline-secondary" id="btnClearAll">Limpiar</button>
                  <span class="ms-1 xsmall text-muted">Sel: <strong id="modelsCount">0</strong></span>
                </div>
              </div>

              <div id="models-container" class="models-scroll">
                <small class="text-muted">Elegí primero la Marca del Auto.</small>
              </div>
            </div>
          </div>

          <button type="submit" class="btn btn-primary w-100 mt-3 py-2">
            <i class="bi bi-check2-circle me-1"></i>Guardar Producto
          </button>

          {% if form.errors %}
            <div class="alert alert-danger mt-3 mb-0">
              <strong>Errores en el formulario:</strong>
              <ul class="mb-0">
                {% for field, errors in form.errors.items %}
                  <li>{{ field }}: {{ errors.0 }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
