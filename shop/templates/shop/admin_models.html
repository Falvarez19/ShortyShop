{% extends "shop/base.html" %}
{% load static %}

{% block content %}
<div class="mm-card">
  <div class="d-flex align-items-center justify-content-between mb-2">
    <h1 class="mm-title m-0">
      <i class="bi bi-car-front"></i> Gestión de Modelos
    </h1>
  </div>

  <!-- Fila: filtro (GET) + alta (POST) -->
  <div class="mm-row mb-3">

    <!-- Filtro por marca (GET) -->
    <form id="filterForm" method="get" class="d-flex gap-2">
      <select id="filterBrand" name="brand" class="form-select">
        <option value="">Todas las marcas</option>
        {% for val,label in brands %}
          <option value="{{ val }}" {% if selected_brand == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <button id="btnFilter" class="btn btn-outline-secondary" type="submit">
        <i class="bi bi-funnel"></i> Filtrar
      </button>
    </form>

    <!-- Alta de modelo (POST normal al mismo view) -->
    <form id="addForm" method="post" action="{% url 'admin_models' %}" class="d-flex gap-2">
      {% csrf_token %}
      <select id="newBrand" name="brand" class="form-select" required>
        <option value="" disabled selected>Marca</option>
        {% for val,label in brands %}
          <option value="{{ val }}">{{ label }}</option>
        {% endfor %}
      </select>

      <input id="newModel" type="text" name="name" class="form-control" placeholder="Nombre del modelo" required>

      <button id="btnAddModel" type="submit" class="btn btn-blue">
        <i class="bi bi-plus-lg"></i> <span>Agregar</span>
      </button>
    </form>

  </div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="mm-table w-100">
      <thead>
        <tr>
          <th>ID</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody id="modelsTbody">
        {% for m in models %}
          <tr data-id="{{ m.id }}">
            <td>{{ m.id }}</td>
            <td>{{ m.get_marca_display }}</td>
            <td>{{ m.name }}</td>
            <td class="text-end">
              <form action="{% url 'delete_model' m.id %}" method="post" class="d-inline">
                {% csrf_token %}
                <button class="btn btn-red btn-sm" onclick="return confirm('¿Eliminar {{ m.name }}?')">
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr class="empty"><td colspan="4" class="mm-muted">No hay modelos para mostrar.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
